(function(e){function t(t,r,i){var o=t.attr("id"),u=e("input#"+o+"-score"),c=t.children("img."+o);t.mouseleave(function(){a(t,u.val(),r);n(i,u,r)});c.bind(r.half?"mousemove":"mouseover",function(n){s(o,this.alt,r);if(r.half){var u=parseFloat(((n.pageX-e(this).offset().left)/r.size).toFixed(1));u=u>=0&&u<.5?.5:1;t.data("score",parseFloat(this.alt)+u-1);l(t,t.data("score"),r)}else{s(o,this.alt,r)}f(i,this.alt,r)}).click(function(e){u.val(r.half?t.data("score"):this.alt);if(r.click){r.click.apply(t,[u.val(),e])}})}function n(e,t,n){if(e!==null){var r="";if(n.targetKeep){r=t.val();if(n.targetType=="hint"){if(t.val()==""&&n.cancel){r=n.cancelHint}else{r=n.hintList[Math.ceil(t.val())-1]}}}if(u(e)){e.val(r)}else{e.html(r)}}}function r(t,n,r){var s=undefined;if(n==undefined){i("Specify an ID or class to be the target of the action.");return}if(n){if(n.indexOf(".")>=0){var o;return e(n).each(function(){o="#"+e(this).attr("id");if(r=="start"){e.fn.raty.start(t,o)}else if(r=="click"){e.fn.raty.click(t,o)}else if(r=="readOnly"){e.fn.raty.readOnly(t,o)}})}s=e(n);if(!s.length){i('"'+n+'" is a invalid identifier for the public funtion $.fn.raty.'+r+"().");return}}return s}function i(e){if(window.console&&window.console.log){window.console.log(e)}}function s(t,n,r){var i=e("img."+t).length,s=0,o=0,u,a;for(var f=1;f<=i;f++){u=e("img#"+t+"-"+f);if(f<=n){if(r.iconRange&&r.iconRange.length>s){a=r.iconRange[s][0];o=r.iconRange[s][1];if(f<=o){u.attr("src",r.path+a)}if(f==o){s++}}else{u.attr("src",r.path+r.starOn)}}else{u.attr("src",r.path+r.starOff)}}}function o(e,t,n){if(t!=0){t=parseInt(t);hint=t>0&&n.number<=n.hintList.length&&n.hintList[t-1]!==null?n.hintList[t-1]:t}else{hint=n.noRatedMsg}e.attr("title",hint).children("img").attr("title",hint)}function u(e){return e.is("input")||e.is("select")||e.is("textarea")}function a(t,n,r){var i=t.attr("id");if(isNaN(parseInt(n))){t.children("img."+i).attr("src",r.path+r.starOff);e("input#"+i+"-score").removeAttr("value");return}if(n<0){n=0}else if(n>r.number){n=r.number}s(i,n,r);if(n>0){e("input#"+i+"-score").val(n);if(r.half){l(t,n,r)}}if(r.readOnly||t.css("cursor")=="default"){o(t,n,r)}}function f(e,t,n){if(e!==null){var r=t;if(n.targetType=="hint"){if(t==0&&n.cancel){r=n.cancelHint}else{r=n.hintList[t-1]}}if(u(e)){e.val(r)}else{e.html(r)}}}function l(t,n,r){var i=t.attr("id"),s=Math.ceil(n),o=(s-n).toFixed(1);if(o>.25&&o<=.75){s=s-.5;e("img#"+i+"-"+Math.ceil(s)).attr("src",r.path+r.starHalf)}else if(o>.75){s--}else{e("img#"+i+"-"+s).attr("src",r.path+r.starOn)}}e.fn.raty=function(n){if(this.length==0){i("Selector invalid or missing!");return}else if(this.length>1){return this.each(function(){e.fn.raty.apply(e(this),[n])})}var r=e.extend({},e.fn.raty.defaults,n),u=e(this),a=this.attr("id"),c=0,h=r.starOn,p="",d=r.target,v=r.width?r.width:r.number*r.size+r.number*4;if(a===undefined){a="raty-"+u.index();u.attr("id",a)}if(r.number>20){r.number=20}else if(r.number<0){r.number=0}if(r.path.substring(r.path.length-1,r.path.length)!="/"){r.path+="/"}u.data("options",r);if(!isNaN(parseInt(r.start))&&r.start>0){c=r.start>r.number?r.number:r.start}for(var m=1;m<=r.number;m++){h=c>=m?r.starOn:r.starOff;p=m<=r.hintList.length&&r.hintList[m-1]!==null?r.hintList[m-1]:m;u.append('<img id="'+a+"-"+m+'" src="'+r.path+h+'" alt="'+m+'" title="'+p+'" class="'+a+'"/>').append(m<r.number?" ":"")}if(r.iconRange&&c>0){s(a,c,r)}var g=e("<input/>",{id:a+"-score",type:"hidden",name:r.scoreName}).appendTo(u);if(c>0){g.val(c)}if(r.half){l(u,e("input#"+a+"-score").val(),r)}if(!r.readOnly){if(d!==null){d=e(d);if(d.length==0){i("Target selector invalid or missing!")}}if(r.cancel){var y=e("img."+a),b='<img src="'+r.path+r.cancelOff+'" alt="x" title="'+r.cancelHint+'" class="button-cancel"/>';if(r.cancelPlace=="left"){u.prepend(b+" ")}else{u.append(" ").append(b)}e("#"+a+" img.button-cancel").mouseenter(function(){e(this).attr("src",r.path+r.cancelOn);y.attr("src",r.path+r.starOff);f(d,"",r)}).mouseleave(function(){e(this).attr("src",r.path+r.cancelOff);u.mouseout()}).click(function(t){e("input#"+a+"-score").removeAttr("value");if(r.click){r.click.apply(u,[null,t])}});u.css("width",v+r.size+4)}else{u.css("width",v)}u.css("cursor","pointer");t(u,r,d)}else{u.css("cursor","default");o(u,c,r)}return u};e.fn.raty.cancel=function(t,n){var r=n===undefined?false:true;if(r){e.fn.raty.click("",t,"cancel")}else{e.fn.raty.start("",t,"cancel")}return e.fn.raty};e.fn.raty.click=function(t,n){var s=r(t,n,"click"),o=e(n).data("options");a(s,t,o);if(o.click){o.click.apply(s,[t])}else{i('You must add the "click: function(score, evt) { }" callback.')}return e.fn.raty};e.fn.raty.readOnly=function(n,i){var s=r(n,i,"readOnly"),o=e(i).data("options"),u=s.children("img.button-cancel");if(u[0]){n?u.hide():u.show()}if(n){e("img."+s.attr("id")).unbind();s.css("cursor","default").unbind()}else{t(s,o);s.css("cursor","pointer")}return e.fn.raty};e.fn.raty.start=function(t,n){var i=r(t,n,"start"),s=e(n).data("options");a(i,t,s);return e.fn.raty};e.fn.raty.defaults={cancel:false,cancelHint:"cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:null,half:false,hintList:["","","","",""],noRatedMsg:"",number:5,path:"/static/images/",iconRange:[],readOnly:false,scoreName:"rate",size:24,starHalf:"star-half.png",starOff:"star-off-big.png",starOn:"star-on-big.png",start:0,target:null,targetKeep:false,targetType:"hint",width:159}})(jQuery)