{% from "security/_macros.html" import render_field_with_errors, render_field %}
{% extends "layout.html" %}

{%block title%}Esya Kutuphanesi{%endblock%}
{% block content %}
    <script type="text/javascript" src="{{ url_for('static',filename='js/gmaps.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static',filename='js/ek.js') }}"></script>
    <link rel="stylesheet" href="{{url_for('static',filename='css/ek.css')}}">
    <script>
        $(function(){
            if($("select#address").val() == 20){
                $("#new_address").show();
            } else {
                $("#new_address").hide();
            }
            $("select#category").change(function(e){
                $.getJSON('/get_stuff_types/'+$(this).val(),'',function(j){
                    stuff_type = document.getElementById('stuff_type');
                    stuff_type.innerHTML = ''
                    $.each(j, function(key,value){
                        console.log(value);
                        stuff_type.innerHTML += "<option value='"+value.id+"'>"+value.name+"</option>";
                    });
                });
            });
            $("select#address").change(function(e){
                if($("select#address").val() == 20){
                    $("#new_address").show();
                } else {
                    $("#new_address").hide();
                }
            });
        })
    </script>
    <div class="col-md-8 col-md-offset-2">
        {% if not is_new %}
            {% if not stuff.approved %}
                <p class="alert-danger">Eşyanız henüz onaylanmadı</p>
            {% endif %}
        {% endif %}
        <form action="{{ form_action }}" method="POST" name="edit_stuff_form" enctype="multipart/form-data">
          {{ form.hidden_tag() }}
          {{ render_field_with_errors(form.title) }}
          {{ render_field_with_errors(form.category) }}
          {{ render_field_with_errors(form.stuff_type) }}
          {{ render_field_with_errors(form.detail) }}
            {{ render_field_with_errors(form.is_wanted) }}
          {{ render_field_with_errors(form.address) }}
            <div id="new_address">
                <input type="text" id="address_str" class="form-group" name="address_str" diasble/>
                <input id ='search' type="button" class="btn" value="Ara" />
                <div id="map"></div>
                <input type="hidden" id="lat" name="lat"/>
                <input type="hidden" id="lng" name="lng"/>

            </div>
            {{ render_field_with_errors(form.group) }}
          {{ render_field_with_errors(form.photo) }}

            {%if stuff%}
                <div class="col-md-12">
                    {%for photo in stuff.photos%}
                    <div class="col-md-3">
                        <img class="img-responsive" src="/photos/{{photo.filename}}" />
                     </div>
                    {%endfor%}
                </div>
            {%endif%}

          {{ render_field_with_errors(form.tags) }}
            {%for tag in stuff.tags%}
                <span class="label label-warning">{{tag}}</span>
            {%endfor%}
            <div style="margin-top:20px;">
                {{ render_field(form.submit) }}
            </div>

        </form>

    </div>

{% endblock %}

