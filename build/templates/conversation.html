{% from "security/_macros.html" import render_field_with_errors, render_field, render_textarea_with_errors  %}
{% extends "layout.html" %}
{%block title%}Esya Kutuphanesi{%endblock%}
{% block content %}
    <script>
        function updateRequestStatus(status){
            if (confirm("Emin misiniz?")) {
                window.location = "/conversations/{{ conversation.id }}?status="+status;
            }
        }
    </script>
    <div class="col-md-8 col-md-offset-2">
         <h1>{{conversation.title}}</h1>
         <form action="/conversations/{{ conversation.id }}" method="post">
             {{ form.hidden_tag() }}
          <div class="form-group">
            {{ render_field_with_errors(form.message, label_visible=False, placeholder=form.message.label.text) }}
          </div>

          {{ form.submit(class_='btn btn-default')}}
         </form>
        {% if user == conversation.request.stuff.owner%}
            {% if conversation.request.status == 0%}
                <button class="btn btn-danger" onclick="updateRequestStatus(1)">Verdim</button>
            {% elif conversation.request.status == 1 %}
                <button class="btn btn-warning" onclick="updateRequestStatus(2)">Geri aldÄ±m</button>
            {% endif%}
        {%endif%}
        {% for message in conversation.messages | reverse %}
            <div class="row">
                <div class="col-md-4">
                    {{ message.user.name }}
                </div>
                <div class="col-md-8">
                    {{ message}}
                </div>
            </div>
        {% endfor %}
    </div>
{% endblock %}

